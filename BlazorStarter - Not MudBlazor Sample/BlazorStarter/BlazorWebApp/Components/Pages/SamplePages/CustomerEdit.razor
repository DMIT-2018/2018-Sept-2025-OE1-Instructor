@page "/SamplePages/CustomerEdit/{CustomerID:int}"
<!--
    Adding a parameter within the string substitution syntax { }
    {ParameterName:Datatype}

    Make sure we name the parameter here the exact same as the parameter
    we create in our code behind
-->

@if(CustomerID == 0)
{
    <MudText Typo="Typo.h3">New Customer</MudText>
}
else
{
    <MudText Typo="Typo.h3">Edit Customer: @editCustomer.FirstName @editCustomer.LastName</MudText>
}

<DMIT2018FeedbackAndErrorDisplay ErrorDetails="@errorDetails" ErrorMessage="@errorMessage" FeedbackMessage="@feedbackMessage" />

<MudForm @ref="customerForm" @bind-IsValid="isFormValid" @bind-IsTouched="hasFormChanged">
    <!--
        Inside the mudform can look whatever way we want
    -->
    <MudGrid>
        <!--Column One-->
        <MudItem xs="12" sm="6">
            <MudTextField Label="First Name"
                          @bind-Value="editCustomer.FirstName"
                          Variant="Variant.Outlined"
                          Required
                          RequiredError="First Name must be provided."
                          MaxLength="20"
                          Immediate />
            <MudTextField Label="Last Name"
                          @bind-Value="editCustomer.LastName"
                          Variant="Variant.Outlined"
                          Required
                          RequiredError="Last Name must be provided."
                          MaxLength="50"
                          Immediate />
            <MudTextField Label="Address 1"
                          @bind-Value="editCustomer.Address1"
                          Variant="Variant.Outlined"
                          Required
                          RequiredError="Address 1 must be provided."
                          MaxLength="50"
                          Immediate />
            <MudTextField Label="Address 2"
                          @bind-Value="editCustomer.Address2"
                          Variant="Variant.Outlined"
                          MaxLength="50"
                          Immediate />
            <MudTextField Label="City"
                          @bind-Value="editCustomer.City"
                          Variant="Variant.Outlined"
                          Required
                          RequiredError="City must be provided."
                          MaxLength="50"
                          Immediate />
            <MudSelect @bind-Value="editCustomer.ProvStateID"
                       Variant="Variant.Outlined"
                       Label = "Province"
                       Required
                       RequiredError="Province selected is required."
                       Placeholder="Select Province...">
                @foreach(var item in provinces)
                {
                    <MudSelectItem T="int?" Value="@item.LookupID">@item.Name</MudSelectItem>
                }
            </MudSelect>
        </MudItem>

        <!--Column Two-->
        <MudItem xs="12" sm="6">
            <MudSelect @bind-Value="editCustomer.CountryID"
                       Variant="Variant.Outlined"
                       Label="Country"
                       Required
                       RequiredError="Country selected is required."
                       Placeholder="Select Country...">
                @foreach (var item in countries)
                {
                    <MudSelectItem T="int?" Value="@item.LookupID">@item.Name</MudSelectItem>
                }
            </MudSelect>
            <MudTextField Label="Postal Code"
                          @bind-Value="editCustomer.PostalCode"
                          Variant="Variant.Outlined"
                          Required
                          RequiredError="Postal Code must be provided."
                          MaxLength="20"
                          Immediate />
            <MudTextField Label="Phone Number"
                          @bind-Value="editCustomer.Phone"
                          Variant="Variant.Outlined"
                          Required
                          RequiredError="Phone number must be provided."
                          MaxLength="20"
                          Immediate />
            <MudTextField Label="Email"
                          @bind-Value="editCustomer.Email"
                          Variant="Variant.Outlined"
                          Required
                          RequiredError="Email must be provided."
                          MaxLength="20"
                          Immediate />
            <MudSelect @bind-Value="editCustomer.StatusID"
                       Variant="Variant.Outlined"
                       Label="Status"
                       Required
                       RequiredError="Status selected is required."
                       Placeholder="Select Status...">
                @foreach (var item in statuses)
                {
                    <MudSelectItem T="int?" Value="@item.LookupID">@item.Name</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <MudItem xs="12">
            <MudStack Row AlignItems="AlignItems.Center" Justify="Justify.Center" Spacing="4">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Primary"
                           Disabled=@(!isFormValid || !hasFormChanged)
                           OnClick="AddEditCustomer">
                    Save    
                </MudButton>
                <MudButton Variant="Variant.Filled"
                           Color="Color.Secondary"
                           OnClick="Cancel">
                    @closeButtonText
                </MudButton>
            </MudStack>
        </MudItem>
        <MudItem xs="12" Class="mt-4">
            <MudDataGrid Items="editCustomer.Invoices"
                         Striped
                         FixedFooter
                         FixedHeader
                         Height="20vh">
                <ToolBarContent>
                    <MudSpacer />
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Success"
                               OnClick="NewInvoice">
                        Add Invoice       
                    </MudButton>
                </ToolBarContent>
                <Columns>
                    <TemplateColumn>
                        <HeaderTemplate>
                            Actions
                        </HeaderTemplate>
                        <CellTemplate>
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Secondary"
                                       OnClick="() => EditInvoice(context.Item.InvoiceID)">
                                Edit Invoice       
                            </MudButton>
                        </CellTemplate>
                    </TemplateColumn>
                    <PropertyColumn Property="x => x.InvoiceID" Title="Invoice ID" />
                    <PropertyColumn Property="x => x.InvoiceDate" Title="Date"/>
                    <PropertyColumn Property="x => x.EmployeeName" Title="Employee"/>
                    <PropertyColumn Property="x => x.CustomerName" Title="Customer"/>
                    <PropertyColumn Property="@(x => x.Total.ToString("C2"))" Title="Total"/>
                </Columns>
                <NoRecordsContent>
                    <MudText Typo="Typo.h6">No invoices for the Customer.</MudText>
                </NoRecordsContent>
                <PagerContent>
                    <MudDataGridPager />
                </PagerContent>
            </MudDataGrid>
        </MudItem>
    </MudGrid>
</MudForm>

